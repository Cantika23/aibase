# Example Docker Compose configuration for AIBase with WhatsApp integration
# This file shows how to run AIBase with aimeow (WhatsApp service) in Docker
#
# Usage:
# 1. Copy this file to docker-compose.yml
# 2. Update environment variables as needed
# 3. Run: docker-compose up -d
#
# For development, you can also run aimeow on your host machine and use:
# WHATSAPP_API_URL=http://host.docker.internal:7031/api/v1
# (Docker Desktop for Mac/Windows) or
# WHATSAPP_API_URL=http://172.17.0.1:7031/api/v1
# (Linux Docker)

version: '3.8'

services:
  # AIBase backend + frontend
  aibase:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: aibase
    ports:
      - "5040:5040"
    environment:
      # Basic configuration
      - NODE_ENV=production
      - APP_NAME=AI-BASE

      # OpenAI/LLM API configuration (update with your keys)
      - OPENAI_API_KEY=your-api-key-here
      - OPENAI_BASE_URL=https://api.openai.com/v1
      - OPENAI_MODEL=gpt-4
      - OPENAI_MAX_TOKEN=128000
      - OPENAI_THINKING_MODE=disabled

      # WhatsApp configuration
      # Point to the aimeow service (container name as hostname)
      - WHATSAPP_API_URL=http://aimeow:7031/api/v1

    volumes:
      # Persist data directory
      - aibase-data:/app/data

    depends_on:
      - aimeow

    restart: unless-stopped

  # aimeow WhatsApp service
  # Note: This is a placeholder service. You need to:
  # 1. Build aimeow Docker image, or
  # 2. Use a pre-built aimeow image, or
  # 3. Run aimeow on your host machine and update WHATSAPP_API_URL accordingly
  aimeow:
    # Replace with actual aimeow image
    image: your-aimeow-image:latest
    # Or build from Dockerfile:
    # build:
    #   context: ./bins/aimeow
    #   dockerfile: Dockerfile

    container_name: aimeow
    ports:
      - "7031:7031"

    # aimeow configuration (update as needed)
    environment:
      - PORT=7031

    volumes:
      # Persist aimeow session data
      - aimeow-data:/app/data

    restart: unless-stopped

volumes:
  aibase-data:
    driver: local
  aimeow-data:
    driver: local

# Alternative: Run AIBase in Docker with aimeow on host
#
# If you prefer to run aimeow directly on your host machine (not in Docker):
# 1. Remove the aimeow service from this file
# 2. Update WHATSAPP_API_URL in aibase service to:
#    - Mac/Windows Docker Desktop: http://host.docker.internal:7031/api/v1
#    - Linux Docker: http://172.17.0.1:7031/api/v1 (or your host's Docker bridge IP)
# 3. Remove depends_on: aimeow from aibase service
